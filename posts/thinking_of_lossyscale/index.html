<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>æ·±å…¥ LossyScale | æ³¢æ³¢æ²™ğŸ </title>
<meta name=keywords content="Game Dev,PhysX,æ•°å­¦"><meta name=description content="
æœ¬æ–‡æ˜¯PhysXç‰©ç†å¼•æ“ç³»åˆ—çš„ç•ªå¤–ç¯‡ï¼Œå…¶å®è¦å¼„æ˜ç™½ä¸€ä¸ª3Dæ•°å­¦é—®é¢˜ï¼šå¦‚ä½•å¤„ç†çˆ¶èŠ‚ç‚¹å¸¦æœ‰éå‡åŒ€ç¼©æ”¾ã€å­èŠ‚ç‚¹å¸¦æœ‰æ—‹è½¬æ—¶ï¼Œå­èŠ‚ç‚¹çš„æœ€ç»ˆå¤§å°å’Œå½¢æ€ã€‚
é—®é¢˜æºè‡ªç¬”è€…åœ¨ä¿®æ”¹ç‰©ç†å¼•æ“ä¸ºå…¶æ·»åŠ scaleå±æ€§æ—¶é‡åˆ°çš„ä¸€ä¸ªbugã€‚è§£å†³åå¯¹WorldScaleä¸ºä»€ä¹ˆå«åšLossyScaleã€ç©ºé—´å˜æ¢å’ŒåŸºå˜æ¢æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚"><meta name=author content><link rel=canonical href=https://pps43.github.io/posts/thinking_of_lossyscale/><link crossorigin=anonymous href=/assets/css/stylesheet.da461cdc6aa5b1045299cab0ebd07edbb2f1e481e0c7ae775d260fc5af887327.css integrity="sha256-2kYc3GqlsQRSmcqw69B+27Lx5IHgx653XSYPxa+Icyc=" rel="preload stylesheet" as=style><link rel=icon href=https://pps43.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://pps43.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://pps43.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://pps43.github.io/apple-touch-icon.png><link rel=mask-icon href=https://pps43.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://pps43.github.io/posts/thinking_of_lossyscale/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css integrity="sha512-0aPQyyeZrWj9sCA46UlmWgKOP0mUipLQ6OZXu8l4IcAmD2u31EPEy9VcIMvl7SoAaKe8bLXZhYoMaE/in+gcgA==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://unpkg.com/mermaid/dist/mermaid.min.js></script><script>const config={startOnLoad:!0,theme:"neutral",themeVariables:{lineColor:"#aaaaaa"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(void 0,document.querySelectorAll(".language-mermaid"))}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-7GDH7EZ6GL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7GDH7EZ6GL")}</script><meta property="og:url" content="https://pps43.github.io/posts/thinking_of_lossyscale/"><meta property="og:site_name" content="æ³¢æ³¢æ²™ğŸ "><meta property="og:title" content="æ·±å…¥ LossyScale"><meta property="og:description" content=" æœ¬æ–‡æ˜¯PhysXç‰©ç†å¼•æ“ç³»åˆ—çš„ç•ªå¤–ç¯‡ï¼Œå…¶å®è¦å¼„æ˜ç™½ä¸€ä¸ª3Dæ•°å­¦é—®é¢˜ï¼šå¦‚ä½•å¤„ç†çˆ¶èŠ‚ç‚¹å¸¦æœ‰éå‡åŒ€ç¼©æ”¾ã€å­èŠ‚ç‚¹å¸¦æœ‰æ—‹è½¬æ—¶ï¼Œå­èŠ‚ç‚¹çš„æœ€ç»ˆå¤§å°å’Œå½¢æ€ã€‚ é—®é¢˜æºè‡ªç¬”è€…åœ¨ä¿®æ”¹ç‰©ç†å¼•æ“ä¸ºå…¶æ·»åŠ scaleå±æ€§æ—¶é‡åˆ°çš„ä¸€ä¸ªbugã€‚è§£å†³åå¯¹WorldScaleä¸ºä»€ä¹ˆå«åšLossyScaleã€ç©ºé—´å˜æ¢å’ŒåŸºå˜æ¢æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-19T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-19T00:00:00+00:00"><meta property="article:tag" content="Game Dev"><meta property="article:tag" content="PhysX"><meta property="article:tag" content="æ•°å­¦"><meta name=twitter:card content="summary"><meta name=twitter:title content="æ·±å…¥ LossyScale"><meta name=twitter:description content="
æœ¬æ–‡æ˜¯PhysXç‰©ç†å¼•æ“ç³»åˆ—çš„ç•ªå¤–ç¯‡ï¼Œå…¶å®è¦å¼„æ˜ç™½ä¸€ä¸ª3Dæ•°å­¦é—®é¢˜ï¼šå¦‚ä½•å¤„ç†çˆ¶èŠ‚ç‚¹å¸¦æœ‰éå‡åŒ€ç¼©æ”¾ã€å­èŠ‚ç‚¹å¸¦æœ‰æ—‹è½¬æ—¶ï¼Œå­èŠ‚ç‚¹çš„æœ€ç»ˆå¤§å°å’Œå½¢æ€ã€‚
é—®é¢˜æºè‡ªç¬”è€…åœ¨ä¿®æ”¹ç‰©ç†å¼•æ“ä¸ºå…¶æ·»åŠ scaleå±æ€§æ—¶é‡åˆ°çš„ä¸€ä¸ªbugã€‚è§£å†³åå¯¹WorldScaleä¸ºä»€ä¹ˆå«åšLossyScaleã€ç©ºé—´å˜æ¢å’ŒåŸºå˜æ¢æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://pps43.github.io/posts/"},{"@type":"ListItem","position":2,"name":"æ·±å…¥ LossyScale","item":"https://pps43.github.io/posts/thinking_of_lossyscale/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"æ·±å…¥ LossyScale","name":"æ·±å…¥ LossyScale","description":" æœ¬æ–‡æ˜¯PhysXç‰©ç†å¼•æ“ç³»åˆ—çš„ç•ªå¤–ç¯‡ï¼Œå…¶å®è¦å¼„æ˜ç™½ä¸€ä¸ª3Dæ•°å­¦é—®é¢˜ï¼šå¦‚ä½•å¤„ç†çˆ¶èŠ‚ç‚¹å¸¦æœ‰éå‡åŒ€ç¼©æ”¾ã€å­èŠ‚ç‚¹å¸¦æœ‰æ—‹è½¬æ—¶ï¼Œå­èŠ‚ç‚¹çš„æœ€ç»ˆå¤§å°å’Œå½¢æ€ã€‚ é—®é¢˜æºè‡ªç¬”è€…åœ¨ä¿®æ”¹ç‰©ç†å¼•æ“ä¸ºå…¶æ·»åŠ scaleå±æ€§æ—¶é‡åˆ°çš„ä¸€ä¸ªbugã€‚è§£å†³åå¯¹WorldScaleä¸ºä»€ä¹ˆå«åšLossyScaleã€ç©ºé—´å˜æ¢å’ŒåŸºå˜æ¢æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚\n","keywords":["Game Dev","PhysX","æ•°å­¦"],"articleBody":" æœ¬æ–‡æ˜¯PhysXç‰©ç†å¼•æ“ç³»åˆ—çš„ç•ªå¤–ç¯‡ï¼Œå…¶å®è¦å¼„æ˜ç™½ä¸€ä¸ª3Dæ•°å­¦é—®é¢˜ï¼šå¦‚ä½•å¤„ç†çˆ¶èŠ‚ç‚¹å¸¦æœ‰éå‡åŒ€ç¼©æ”¾ã€å­èŠ‚ç‚¹å¸¦æœ‰æ—‹è½¬æ—¶ï¼Œå­èŠ‚ç‚¹çš„æœ€ç»ˆå¤§å°å’Œå½¢æ€ã€‚ é—®é¢˜æºè‡ªç¬”è€…åœ¨ä¿®æ”¹ç‰©ç†å¼•æ“ä¸ºå…¶æ·»åŠ scaleå±æ€§æ—¶é‡åˆ°çš„ä¸€ä¸ªbugã€‚è§£å†³åå¯¹WorldScaleä¸ºä»€ä¹ˆå«åšLossyScaleã€ç©ºé—´å˜æ¢å’ŒåŸºå˜æ¢æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚\nèƒŒæ™¯ PhysXå¼•æ“ä¸­ï¼Œåœºæ™¯å†…çš„Actorä¹‹é—´å¹¶æ²¡æœ‰çˆ¶å­å±‚çº§å…³ç³»ï¼Œä»…æœ‰çš„å±‚çº§æ˜¯Shapeå¯ä»¥ç»‘å®šåˆ°Actorä½œä¸ºå­èŠ‚ç‚¹ã€‚ PhysXå¼•æ“ä¸­å¹¶æ²¡æœ‰Scaleçš„æ¦‚å¿µï¼Œå³PxTransformåªåŒ…å«Positionå’ŒRotationï¼Œè€Œå¤§å°åªåæ˜ åœ¨æœ€åº•å±‚Shapeçš„å°ºå¯¸ä¸Šï¼ˆæ¯”å¦‚çƒå½¢ç¢°æ’ç›’æœ‰åŠå¾„è¿™ä¸ªå±æ€§ï¼‰ã€‚æ‰€ä»¥è®¾ç½®ç¼©æ”¾æ¯”ä¾‹çš„å®ç°æ–¹å¼æ˜¯æ”¹å˜ç‰©ä½“å°ºå¯¸ã€‚ é—®é¢˜çš„å‡ºç° Actorä¸‹å¯ä»¥æœ‰è‹¥å¹²Shapeï¼Œè¿™é‡Œåªè®¨è®ºæœ‰ä¸€ä¸ªShapeçš„æƒ…å†µã€‚ç°éœ€è¦å¢åŠ å±æ€§Actor.Scaleï¼Œä¿®æ”¹è¯¥å±æ€§æ—¶è¦ä¿è¯Shape.Dimensionçš„æ­£ç¡®æ€§ã€‚\nclassDiagram direction LR class Actor { PxVec3 Position PxQuat Rotation PxVec3 Scale } class Shape { PxVec3 LocalPosition PxQuat LocalRotation PxVec3 OriginalDimension PxVec3 Dimension } Actor o-- Shape ç»å®è·µï¼Œæ›´æ–¹ä¾¿çš„æ–¹å¼æ˜¯è®°å½•Shapeçš„åˆå§‹å°ºå¯¸OriginalDimensionï¼Œç„¶åä¹˜ä¸Šæ”¹å˜Actor.Scaleåå¯¹åº”Shapeçš„â€œç¼©æ”¾ç³»æ•°â€ã€‚è€Œä¸æ˜¯é€šè¿‡Actor.Scaleæ”¹å˜å‰åçš„æ¯”ä¾‹æ¥è®¡ç®—ã€‚æ€»ä¹‹ï¼Œé—®é¢˜ç®€åŒ–ä¸ºå®ç°GetShapeScale()ã€‚\nShape.Dimension = Shape.OriginalDimension * GetShapeScale(); å½“Shapeç›¸å¯¹Actoræ²¡æœ‰æ—‹è½¬ï¼Œå³Shape.LocalRotation = (0,0,0,1)æ—¶ï¼Œå®¹æ˜“å‘ç°ï¼š\nPxVec3 GetShapeScale() { return actor.Scale; } ä½†æ˜¯å½“åŒæ—¶å­˜åœ¨æ—‹è½¬å’Œéå‡åŒ€ç¼©æ”¾å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå½“Actor.Scale=(1,4,1)ï¼Œè€ŒShapeç»•zè½´è½¬äº†90åº¦ï¼Œé‚£ä¹ˆé¢„æœŸçš„ç»“æœåº”è¯¥æ˜¯(4,1,1)ï¼Œå³Shapeç›¸å¯¹äºè‡ªå·±åœ¨æ¨ªå‘ä¸Šæ‰©å¤§åˆ°2å€ã€‚è‹¥ç»•zè½´è½¬äº†45åº¦ï¼Œé‚£ä¹ˆé¢„æœŸçš„ç»“æœæ˜¯(2,2,1)ã€‚è¦å¦‚ä½•è¾¾åˆ°è¿™ç§æ•ˆæœå‘¢ï¼Ÿ\nä¼¼æ˜¯è€Œéçš„ç®—æ³• ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯ï¼Œè¦è¾¾åˆ°ä¸Šé¢çš„æ•ˆæœï¼Œå…¶å®æ˜¯å°†Actor.Scaleåƒæ–¹å‘çŸ¢é‡é‚£æ ·æ—‹è½¬åˆ°Shapeç©ºé—´å†…ã€‚\nPxVec3 GetShapeScale() { PxTransform shapeSpace = shape-\u003egetLocalPose(); return shapeSpace-\u003erotate(actor.Scale); } ç„¶è€Œåä¾‹æ˜¯ï¼šactorScale=(1,1,1)ç»è¿‡æ—‹è½¬åå¯èƒ½ä¸å†æ˜¯(1,1,1)ï¼Œå³Shapeå åŠ äº†ä¸€ä¸ªç¼©æ”¾ã€‚è¿™æ˜¯ä¸äº‹å®è¿èƒŒçš„ã€‚é’ˆå¯¹(1,1,1)ç‰¹æ®Šå¤„ç†ä¹Ÿå¹¶ä¸æ­£ç¡®ï¼Œå› ä¸ºå¯¹äºä»»æ„(X,Y,Z)ï¼Œæ€»æœ‰ä¸€ç§æ—‹è½¬è®©å…¶æŸä¸ªåˆ†é‡ä¸º0ã€‚\nè¿™ç§ç®—æ³•çš„é”™è¯¯ä¹‹å¤„åœ¨æœ€åä¸€èŠ‚ä¼šé¢å¤–è®¨è®ºã€‚\næ­£ç¡®çš„ç®—æ³• åœ¨Unityçš„æ–‡æ¡£ä¸­ï¼Œå¯¹äºTransform.LossyScaleè¿™æ ·è¯´æ˜ï¼š\nThe global scale of the object (Read Only).\nPlease note that if you have a parent transform with scale and a child that is arbitrarily rotated, the scale will be skewed. Thus scale can not be represented correctly in a 3 component vector but only a 3x3 matrix. Such a representation is quite inconvenient to work with however. lossyScale is a convenience property that attempts to match the actual world scale as much as it can. If your objects are not skewed the value will be completely correct and most likely the value will not be very different if it contains skew too.\nç†è§£ï¼Œä½†ä¸å®Œå…¨ç†è§£ã€‚ç›´åˆ°æ‰¾æ¥æºç åˆ†æäº†ä¸€ç•ªã€‚å»ç²—å–ç²¾ï¼Œæ ¹æ®ä»£ç æç‚¼å‡ºå…¬å¼ï¼š\n$$ R_{world}=R_1R_2â€¦R_N $$ $$ W_{world}=R_1S_1R_2S_2â€¦R_NS_N $$ $$ S_{world}=R_{world}^{-1}W_{world} $$ $$ s = diag(S_{world}) $$\nä¸Šå¼ä¸­ï¼Œ\\(1â€¦N\\)æ˜¯æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„ç¼–å·ï¼Œæ‰€æœ‰çŸ©é˜µå‡é‡‡ç”¨åˆ—ä¼˜å…ˆçŸ©é˜µï¼ˆå› æ­¤ä½¿ç”¨å·¦ä¹˜ï¼Œä¾‹å¦‚\\(R_{world}\\)å«ä¹‰æ˜¯å…ˆä½¿ç”¨\\(R_N\\)è¿›è¡Œå˜æ¢åˆ°çˆ¶ç©ºé—´ï¼Œç„¶åä¾æ¬¡â€¦â€¦ç›´åˆ°ä½¿ç”¨\\(R_1\\)å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ï¼‰ã€‚\\(R_i\\)æ˜¯åªåŒ…å«è‡ªèº«æ—‹è½¬ä¿¡æ¯çš„3x3æ—‹è½¬çŸ©é˜µã€‚\\(S_i\\)æ˜¯åªåŒ…å«è‡ªèº«ç¼©æ”¾ä¿¡æ¯çš„3x3å¯¹è§’çŸ©é˜µã€‚\næœ€ç»ˆç»“æœ\\(s\\)æ˜¯3x1åˆ—çŸ¢é‡ï¼Œå–è‡ª\\(S_{world}\\)çš„å¯¹è§’çº¿å…ƒç´ ã€‚\né™¤äº†å–ä¸»å¯¹è§’çº¿å…ƒç´ ï¼Œè¿˜æœ‰ä¸€ç§è®¡ç®—æ³•æ¥ç¡®å®šæœ€ç»ˆçš„ç¼©æ”¾ç³»æ•°ï¼šå–æ¯ä¸€åˆ—çš„æ¨¡é•¿ä½œä¸ºç³»æ•°ã€‚è¿™ä¸ªåšæ³•çš„ä¼˜ç‚¹æ˜¯ç²¾ç¡®ä¿ç•™äº†æ¯ä¸ªè½´ç¼©æ”¾åçš„é•¿åº¦ï¼Œä¸è¿‡è¿™æ ·éœ€è¦ä¸ºè´Ÿæ•°ç¼©æ”¾å¤šä¸€äº›å¤„ç†ï¼šè®¡ç®—å˜æ¢çš„è¡Œåˆ—å¼ï¼Œå¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™å°†xè½´çš„ç¼©æ”¾æ·»åŠ è´Ÿå·ã€‚\nç®—æ³•æ¨å¯¼ä¸è§£é‡Š ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å‘¢ï¼Ÿè¿™è¦ä»TRSå˜æ¢çŸ©é˜µè¯´èµ·ã€‚åœ¨3Dä¸­é—´ä¸­çš„å§¿æ€ã€è¿åŠ¨å’Œåæ ‡ç³»éƒ½å¯ä»¥ç”¨çŸ©é˜µè¡¨è¾¾ã€‚ ä¸€èˆ¬\\(T\\)è¡¨ç¤ºä½ç§»ï¼Œ\\(R\\)è¡¨ç¤ºæ—‹è½¬ï¼Œ\\(S\\) è¡¨ç¤ºç¼©æ”¾ã€‚\nè´´å¿ƒæç¤ºï¼š\nç”¨æ¬§æ‹‰è§’è¡¨ç¤ºåˆ™éœ€è¦è§„å®šæ—‹è½¬è½´æ¬¡åºå¦åˆ™æœ‰æ­§ä¹‰ï¼ˆæ„Ÿå…´è¶£å¯ä»¥æœç´¢ä¸‡å‘èŠ‚æ­»é”ï¼‰ã€‚ç»è¿‡å®éªŒï¼ŒUnityä½¿ç”¨YXZï¼Œå³å¯¹äº\\((\\theta_x,\\theta_y,\\theta_z)\\)ï¼Œå…ˆæŒ‰ç…§Yè½´è½¬ \\(\\theta_y\\) ï¼Œå†æŒ‰ç…§è½¬åŠ¨åçš„Xè½´è½¬\\(\\theta_x\\)ï¼Œå†æŒ‰ç…§è½¬åŠ¨åçš„Zè½´è½¬\\(\\theta_z\\)ã€‚ æœ‰æ—¶ä½¿ç”¨4x4è€Œä¸æ˜¯3x3çŸ©é˜µåªæ˜¯ä¸€ä¸ªæ•°å­¦ä¸Šçš„æŠ€å·§ï¼Œä¸ºäº†è®©æ‰€æœ‰å˜æ¢éƒ½å¯ä»¥ç”¨çŸ©é˜µä¹˜æ³•ä¸²è”èµ·æ¥ã€‚ æœ‰æ—¶ä½¿ç”¨åˆ†å—çŸ©é˜µä¹Ÿåªæ˜¯ä¸€ä¸ªæ•°å­¦ä¸Šçš„æŠ€å·§ï¼Œä¸ºäº†ç®€åŒ–å…¬å¼å‘ç°è§„å¾‹ã€‚ å¯¹äºåˆ—ä¼˜å…ˆçŸ©é˜µï¼Œå°†åˆ—çŸ¢é‡\\(v_1\\)å…ˆæŒ‰ç…§\\(M_1\\)å˜æ¢å†æŒ‰ç…§\\(M_2\\)å˜æ¢åˆ°\\(v_2\\)ï¼Œå†™ä½œ\\(v_2=M_2M_1v_1\\)ã€‚ æ›´å¤šèµ„æ–™è¯·å‚è€ƒã€Šæ¸¸æˆå¼•æ“æ¶æ„ã€‹ã€ä»»ä½•è®²è§£3Dæ¸¸æˆå¼€å‘æˆ–å›¾å½¢å­¦çš„ä¹¦ç±ã€‚ $$ T= \\begin{pmatrix} 1 \u0026 0 \u0026 0 \u0026 Tx \\\\ 0 \u0026 1 \u0026 0 \u0026 Ty \\\\ 0 \u0026 0 \u0026 1 \u0026 Tz \\\\ 0 \u0026 0 \u0026 0 \u0026 1 \\end{pmatrix}= \\begin{pmatrix} I \u0026 \\bar{T}\\\\ 0 \u0026 0 \\end{pmatrix} $$\n$$ R_x= \\begin{pmatrix} 1 \u0026 0 \u0026 0 \u0026 0 \\\\ 0 \u0026 \\cos\\theta_x \u0026 -\\sin\\theta_x \u0026 0 \\\\ 0 \u0026 \\sin\\theta_x \u0026 \\cos\\theta_x \u0026 0 \\\\ 0 \u0026 0 \u0026 0 \u0026 1 \\end{pmatrix} $$\n$$ R_y= \\begin{pmatrix} \\cos\\theta_y \u0026 0 \u0026 \\sin\\theta_y \u0026 0 \\\\ 0 \u0026 1 \u0026 0 \u0026 0 \\\\ -\\sin\\theta_y \u0026 0 \u0026 \\cos\\theta_y \u0026 0 \\\\ 0 \u0026 0 \u0026 0 \u0026 1 \\end{pmatrix} $$\n$$ R_z= \\begin{pmatrix} \\cos\\theta_z \u0026 -\\sin\\theta_z \u0026 0 \u0026 0 \\\\ \\sin\\theta_z \u0026 \\cos\\theta_z \u0026 0 \u0026 0 \\\\ 0 \u0026 0 \u0026 1 \u0026 0 \\\\ 0 \u0026 0 \u0026 0 \u0026 1 \\end{pmatrix} $$\n$$ R = R_zR_xR_y= \\begin{pmatrix} r_{11} \u0026 r_{12} \u0026 r_{13} \u0026 0 \\\\ r_{21} \u0026 r_{22} \u0026 r_{23} \u0026 0 \\\\ r_{31} \u0026 r_{32} \u0026 r_{33} \u0026 0 \\\\ 0 \u0026 0 \u0026 0 \u0026 1 \\end{pmatrix}= \\begin{pmatrix} \\bar{R} \u0026 0 \\\\ 0 \u0026 1 \\end{pmatrix} $$\n$$ S= \\begin{pmatrix} s_x \u0026 0 \u0026 0 \u0026 0 \\\\ 0 \u0026 s_y \u0026 0 \u0026 0 \\\\ 0 \u0026 0 \u0026 s_z \u0026 0 \\\\ 0 \u0026 0 \u0026 0 \u0026 1 \\end{pmatrix}= \\begin{pmatrix} \\bar{S} \u0026 0 \\\\ 0 \u0026 1 \\end{pmatrix} $$\nåˆ™å¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶æœ¬åœ°åæ ‡ç³»çš„TRSå˜æ¢çŸ©é˜µå¯ä»¥å†™ä½œï¼š\n$$ M=\\begin{pmatrix} r_{11}S_x \u0026 r_{12}S_y \u0026 r_{13}S_z \u0026 T_x \\\\ r_{21}S_x \u0026 r_{22}S_y \u0026 r_{23}S_z \u0026 T_y \\\\ r_{31}S_x \u0026 r_{32}S_y \u0026 r_{33}S_z \u0026 T_z \\\\ 0 \u0026 0 \u0026 0 \u0026 1 \\end{pmatrix}= \\begin{pmatrix} \\bar{R}\\bar{S} \u0026 \\bar{T} \\\\ 0 \u0026 1 \\end{pmatrix} $$\nå¯¹äºçˆ¶å­èŠ‚ç‚¹\\(M_1\\)ä¸‹çš„å­èŠ‚ç‚¹\\(M_2\\)åæ ‡ç³»ï¼Œå…¶ç›¸å¯¹äºä¸–ç•Œåæ ‡ç³»çš„å˜æ¢çŸ©é˜µå¯ä»¥å†™ä½œï¼š\n$$ M_{world}=M_1M_2= \\begin{pmatrix} \\bar{R_1}\\bar{S_1} \u0026 \\bar{T_1} \\\\ 0 \u0026 1 \\end{pmatrix} \\begin{pmatrix} \\bar{R_2}\\bar{S_2} \u0026 \\bar{T_2} \\\\ 0 \u0026 1 \\end{pmatrix}= \\begin{pmatrix} \\bar{R_1}\\bar{S_1}\\bar{R_2}\\bar{S_2} \u0026 \\bar{R_1}\\bar{S_1}\\bar{T_2}+\\bar{T_1} \\\\ 0 \u0026 1 \\end{pmatrix} $$\næ€è·¯1 ä»å¦ä¸€ä¸ªè§’åº¦æ€è€ƒï¼Œè‹¥è¦å°†\\(M_{world}\\)æ‹†åˆ†æˆTRSä¸‰ä¸ªåˆ†é‡ï¼Œæ˜¯å¦å°±å¯¹åº”ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ä½ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ï¼ˆå…¨å±€ç¼©æ”¾æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼‰å‘¢ï¼Ÿå®¹æ˜“è§‚å¯Ÿåˆ°å…¨å±€ä½ç§»æ˜¯ï¼š\n$$ T_{world}= \\begin{pmatrix} \\bar{R_1}\\bar{S_1}\\bar{T_2}+\\bar{T_1} \\end{pmatrix} $$\nè€Œå…¨å±€æ—‹è½¬ç”±äºå…¶ç‰©ç†æ„ä¹‰ï¼Œå¿…ç„¶æ˜¯ï¼š\n$$ R_{world}= \\bar{R_1}\\bar{R_2} $$\nåˆ™å…¨å±€ç¼©æ”¾åªèƒ½æ˜¯ï¼š\n$$ S_{world}=R_{world}^{-1}=(\\bar{R_1}\\bar{S_1}\\bar{R_2}\\bar{S_2})=(\\bar{R}_2^{-1}\\bar{S_1}\\bar{R_2})\\bar{S_2} $$\nä¸€èˆ¬æ¥è¯´ï¼Œ\\(S_{world}\\)æ˜¯ä¸€ä¸ªéå¯¹è§’çŸ©é˜µï¼Œå³ä¸»å¯¹è§’çº¿ä¹‹å¤–ä¹Ÿæœ‰éé›¶å€¼ã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦ç†è§£ï¼Œå°†å­ç©ºé—´çš„æ ‡å‡†æ­£äº¤åŸºå˜æ¢åˆ°çˆ¶ç©ºé—´åï¼Œè¿™ç»„åŸºé™¤äº†æ¨¡é•¿å‘ç”Ÿäº†å˜æ¢ï¼Œä¹Ÿä¸å†ä¸¤ä¸¤å‚ç›´äº†â€”â€”è¿™ä¹Ÿå«å­èŠ‚ç‚¹å‘ç”Ÿäº†å‰ªåˆ‡ï¼ˆShearï¼‰ã€‚å½“æˆ‘ä»¬åªç”¨ä¸€ä¸ªä¸‰ç»´åˆ†é‡è¡¨ç¤ºç¼©æ”¾æ—¶ï¼ŒåŠ¿å¿…è¦ä¸¢å¤±è¿™ç»„åŸºä¹‹é—´çš„å¤¹è§’ä¿¡æ¯ï¼Œè¿™ä¹Ÿæ˜¯LossyScaleåå­—çš„ç”±æ¥ã€‚åªæœ‰å½“çˆ¶èŠ‚ç‚¹æ˜¯å‡åŒ€ç¼©æ”¾ï¼ˆ\\(\\bar{S_1}=s_1I\\)ï¼‰ã€æˆ–å­èŠ‚ç‚¹æ²¡æœ‰ç›¸å¯¹æ—‹è½¬ï¼ˆ\\(\\bar{R_2}=I\\)ï¼‰æ—¶ï¼Œå…¨å±€ç¼©æ”¾ç³»æ•°å¯ä»¥åŒ–ç®€ä¸º\\(S_{world}=\\bar{S_1}\\bar{S_2}=[s_x,s_y,s_z]^T\\)ï¼Œå…¶æ˜¯ä¸€ä¸ªå¯¹è§’çŸ©é˜µï¼Œå³LossyScaleåŒ…å«äº†å®Œæ•´çš„ç¼©æ”¾ä¿¡æ¯ã€‚\næ€è·¯2 é™¤äº†ä¸Šé¢å‡‘å‡º\\(S_{world}\\)è¿›è€Œå¾—åˆ°ç¼©æ”¾ç³»æ•°çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç§æ€è·¯ç›´æ¥æ±‚å¾—ç»“æœã€‚\nä¸Šé¢å·²ç»çŸ¥é“ï¼Œå…¨å±€å˜æ¢çŸ©é˜µä¸ºï¼š $$ M_{world}= \\begin{pmatrix} \\bar{R_1}\\bar{S_1}\\bar{R_2}\\bar{S_2} \u0026 \\bar{R_1}\\bar{S_1}\\bar{T_2}+\\bar{T_1} \\\\ 0 \u0026 1 \\end{pmatrix} $$\nâ€œå…¨å±€ç¼©æ”¾ç³»æ•°â€çš„å®šä¹‰æœ¬è´¨ä¸Šå°±æ˜¯ï¼šå­èŠ‚ç‚¹çš„æœ¬åœ°å•ä½è½´ï¼Œç»è¿‡å±‚å±‚å˜æ¢åï¼Œåœ¨ä¸–ç•Œç©ºé—´ä¸­å˜æˆäº†å¤šé•¿ã€‚å› æ­¤å¯ä»¥å¿½ç•¥å¹³ç§»éƒ¨åˆ†ï¼Œåªçœ‹å˜æ¢ï¼š $$ L = \\bar{R_1}\\bar{S_1}\\bar{R_2}\\bar{S_2} $$\nä»¥å­èŠ‚ç‚¹æœ¬åœ°çš„xè½´åŸºå‘é‡\\(e_x = (1,0,0)^T\\)ä¸ºä¾‹ï¼Œå…¶ç»è¿‡\\(L\\)å˜æ¢åï¼Œæ¨¡é•¿æ˜¯ï¼š $$ s_{world, x} = ||L \\cdot e_x|| = ||\\bar{R_1}\\bar{S_1}\\bar{R_2}\\bar{S_2} \\cdot e_x|| $$\næœ€åä¸€æ¬¡æ—‹è½¬\\(\\bar{R_1}\\)ä¸æ”¹å˜æ¨¡é•¿ï¼Œç›´æ¥å¯å¾—ï¼š\n$$ s_{world, x} = s_{2,x} \\cdot \\sqrt{(r_{2,11} \\cdot s_{1,x})^2 + (r_{2,21} \\cdot s_{1,y})^2 + (r_{2,31} \\cdot s_{1,z})^2} $$\né—®é¢˜çš„ç»ˆç»“ å›åˆ°æœ€åˆçš„é—®é¢˜ä¸Šæ¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨å’ŒUnityä¸€æ ·çš„å–ä¸»å¯¹è§’çº¿å…ƒç´ æ³•è€Œæ²¡æœ‰é€‰å–æ¨¡æ³•ã€‚å¯¹Actorè®¾ç½®ç¼©æ”¾æ—¶è¦æ›´æ–°æ‰€å±Shapeçš„å°ºå¯¸ï¼Œä¸ºæ­¤è¦å®ç°çš„GetShapeScale()å®Œæ•´ç‰ˆï¼š\nShape.Dimension = Shape.OriginalDimension * GetShapeScale(); PhysXVec3 GetShapeScale() { PxQuat worldRot = actor.Rotation * shapeTransform.q; PxMat33 inverseWorldRotMat = PxMat33(worldRot.getConjugate()); PxMat33 localRotMat = PxMat33(shapeTransform.q); PxMat33 actorRotMat = PxMat33(actor.Rotation); PxMat33 actorScaleMat = PxMat33().createDiagonal(actor.Scale); PxMat33 worldRotAndScaleMat = actorRotMat * actorScaleMat * localRotMat /* * localScaleMat*/; // localScaleMat is always Identity Matrix, so we omit it PxMat33 worldScaleMat = inverseWorldRotMat * worldRotAndScaleMat; PhysXVec3 worldscale = PhysXVec3(worldScaleMat[0][0], worldScaleMat[1][1], worldScaleMat[2][2]); // can have extra logic to make sure all values in worldscale are non-zero return worldscale; } é¢å¤–çš„è®¨è®º å·²çŸ¥æ­£ç¡®çš„ç®—æ³•æ˜¯ï¼š\n$$ S_{world}=(\\bar{R}_2^{-1}\\bar{S_1}\\bar{R_2})\\bar{S_2} $$\nè€Œä¼¼æ˜¯è€Œéçš„ç®—æ³•å…¶å®æ˜¯ï¼š\n$$ S_{world}=(\\bar{R_2}s_1)\\bar{S_2} $$\næœ¬è´¨é”™è¯¯åœ¨äºï¼š\næ­£ç¡®çš„ç®—æ³•æ˜¯å°†ç¼©æ”¾æœ¬èº«è§†ä¸ºä¸€ä¸ªç©ºé—´å˜æ¢\\(S_1\\)ï¼Œè¿›è¡ŒåŸºå˜æ¢ã€‚ é”™è¯¯çš„ç®—æ³•æ˜¯å°†ç¼©æ”¾ç³»æ•°è§†ä¸ºä¸€ä¸ªæ™®é€šçŸ¢é‡\\(s_1\\) ï¼Œè¿›è¡Œç©ºé—´å˜æ¢ã€‚ è¿™äº›åœ¨å¤§ä¸€çš„è¯¾å ‚ä¸Šæ—©å·²å­¦è¿‡ã€‚å¾€å¾€æ­£å‘è§£é‡Šå¾ˆç®€å•ï¼Œéš¾çš„æ˜¯åå‘æ€è€ƒï¼Œå³é‡åˆ°å®é™…é—®é¢˜æ€ä¹ˆé€‰æ‹©åˆé€‚çš„æ¦‚å¿µå»è§£å†³ã€‚\nçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚\n","wordCount":"3320","inLanguage":"en","datePublished":"2023-07-19T00:00:00Z","dateModified":"2023-07-19T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://pps43.github.io/posts/thinking_of_lossyscale/"},"publisher":{"@type":"Organization","name":"æ³¢æ³¢æ²™ğŸ ","logo":{"@type":"ImageObject","url":"https://pps43.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pps43.github.io/ accesskey=h title="æ³¢æ³¢æ²™ğŸ  (Alt + H)">æ³¢æ³¢æ²™ğŸ </a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pps43.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://pps43.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://pps43.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://book.enginew.cn/ title=BookOfGameDev><span>BookOfGameDev</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">æ·±å…¥ LossyScale</h1><div class=post-meta><span title='2023-07-19 00:00:00 +0000 UTC'>July 19, 2023</span>&nbsp;Â·&nbsp;7 min</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%83%8c%e6%99%af aria-label=èƒŒæ™¯>èƒŒæ™¯</a></li><li><a href=#%e9%97%ae%e9%a2%98%e7%9a%84%e5%87%ba%e7%8e%b0 aria-label=é—®é¢˜çš„å‡ºç°>é—®é¢˜çš„å‡ºç°</a></li><li><a href=#%e4%bc%bc%e6%98%af%e8%80%8c%e9%9d%9e%e7%9a%84%e7%ae%97%e6%b3%95 aria-label=ä¼¼æ˜¯è€Œéçš„ç®—æ³•>ä¼¼æ˜¯è€Œéçš„ç®—æ³•</a></li><li><a href=#%e6%ad%a3%e7%a1%ae%e7%9a%84%e7%ae%97%e6%b3%95 aria-label=æ­£ç¡®çš„ç®—æ³•>æ­£ç¡®çš„ç®—æ³•</a></li><li><a href=#%e7%ae%97%e6%b3%95%e6%8e%a8%e5%af%bc%e4%b8%8e%e8%a7%a3%e9%87%8a aria-label=ç®—æ³•æ¨å¯¼ä¸è§£é‡Š>ç®—æ³•æ¨å¯¼ä¸è§£é‡Š</a><ul><li><a href=#%e6%80%9d%e8%b7%af1 aria-label=æ€è·¯1>æ€è·¯1</a></li><li><a href=#%e6%80%9d%e8%b7%af2 aria-label=æ€è·¯2>æ€è·¯2</a></li></ul></li><li><a href=#%e9%97%ae%e9%a2%98%e7%9a%84%e7%bb%88%e7%bb%93 aria-label=é—®é¢˜çš„ç»ˆç»“>é—®é¢˜çš„ç»ˆç»“</a></li><li><a href=#%e9%a2%9d%e5%a4%96%e7%9a%84%e8%ae%a8%e8%ae%ba aria-label=é¢å¤–çš„è®¨è®º>é¢å¤–çš„è®¨è®º</a></li></ul></div></details></div><div class=post-content><blockquote><p>æœ¬æ–‡æ˜¯<a href=https://pps43.github.io/tags/physx/>PhysXç‰©ç†å¼•æ“ç³»åˆ—</a>çš„ç•ªå¤–ç¯‡ï¼Œå…¶å®è¦å¼„æ˜ç™½ä¸€ä¸ª3Dæ•°å­¦é—®é¢˜ï¼šå¦‚ä½•å¤„ç†çˆ¶èŠ‚ç‚¹å¸¦æœ‰éå‡åŒ€ç¼©æ”¾ã€å­èŠ‚ç‚¹å¸¦æœ‰æ—‹è½¬æ—¶ï¼Œå­èŠ‚ç‚¹çš„æœ€ç»ˆå¤§å°å’Œå½¢æ€ã€‚
é—®é¢˜æºè‡ªç¬”è€…åœ¨ä¿®æ”¹ç‰©ç†å¼•æ“ä¸ºå…¶æ·»åŠ <code>scale</code>å±æ€§æ—¶é‡åˆ°çš„ä¸€ä¸ªbugã€‚è§£å†³åå¯¹<code>WorldScale</code>ä¸ºä»€ä¹ˆå«åš<code>LossyScale</code>ã€ç©ºé—´å˜æ¢å’ŒåŸºå˜æ¢æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚</p></blockquote><h1 id=èƒŒæ™¯>èƒŒæ™¯<a hidden class=anchor aria-hidden=true href=#èƒŒæ™¯>#</a></h1><ul><li>PhysXå¼•æ“ä¸­ï¼Œåœºæ™¯å†…çš„Actorä¹‹é—´å¹¶æ²¡æœ‰çˆ¶å­å±‚çº§å…³ç³»ï¼Œä»…æœ‰çš„å±‚çº§æ˜¯Shapeå¯ä»¥ç»‘å®šåˆ°Actorä½œä¸ºå­èŠ‚ç‚¹ã€‚</li><li>PhysXå¼•æ“ä¸­å¹¶æ²¡æœ‰<code>Scale</code>çš„æ¦‚å¿µï¼Œå³<code>PxTransform</code>åªåŒ…å«<code>Position</code>å’Œ<code>Rotation</code>ï¼Œè€Œå¤§å°åªåæ˜ åœ¨æœ€åº•å±‚<code>Shape</code>çš„å°ºå¯¸ä¸Šï¼ˆæ¯”å¦‚çƒå½¢ç¢°æ’ç›’æœ‰åŠå¾„è¿™ä¸ªå±æ€§ï¼‰ã€‚æ‰€ä»¥è®¾ç½®ç¼©æ”¾æ¯”ä¾‹çš„å®ç°æ–¹å¼æ˜¯æ”¹å˜ç‰©ä½“å°ºå¯¸ã€‚</li></ul><h1 id=é—®é¢˜çš„å‡ºç°>é—®é¢˜çš„å‡ºç°<a hidden class=anchor aria-hidden=true href=#é—®é¢˜çš„å‡ºç°>#</a></h1><p>Actorä¸‹å¯ä»¥æœ‰è‹¥å¹²Shapeï¼Œè¿™é‡Œåªè®¨è®ºæœ‰ä¸€ä¸ªShapeçš„æƒ…å†µã€‚ç°éœ€è¦å¢åŠ å±æ€§<code>Actor.Scale</code>ï¼Œä¿®æ”¹è¯¥å±æ€§æ—¶è¦ä¿è¯<code>Shape.Dimension</code>çš„æ­£ç¡®æ€§ã€‚</p><pre tabindex=0><code class=language-mermaid data-lang=mermaid>classDiagram
direction LR
class Actor {
    PxVec3 Position
    PxQuat Rotation
    PxVec3 Scale
}
class Shape {
    PxVec3 LocalPosition
    PxQuat LocalRotation
    PxVec3 OriginalDimension
    PxVec3 Dimension
}
Actor o-- Shape
</code></pre><p>ç»å®è·µï¼Œæ›´æ–¹ä¾¿çš„æ–¹å¼æ˜¯è®°å½•Shapeçš„åˆå§‹å°ºå¯¸<code>OriginalDimension</code>ï¼Œç„¶åä¹˜ä¸Šæ”¹å˜<code>Actor.Scale</code>åå¯¹åº”Shapeçš„â€œç¼©æ”¾ç³»æ•°â€ã€‚è€Œä¸æ˜¯é€šè¿‡<code>Actor.Scale</code>æ”¹å˜å‰åçš„æ¯”ä¾‹æ¥è®¡ç®—ã€‚æ€»ä¹‹ï¼Œé—®é¢˜ç®€åŒ–ä¸ºå®ç°<code>GetShapeScale()</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Shape</span><span class=p>.</span><span class=n>Dimension</span> <span class=o>=</span> <span class=n>Shape</span><span class=p>.</span><span class=n>OriginalDimension</span> <span class=o>*</span> <span class=n>GetShapeScale</span><span class=p>();</span>
</span></span></code></pre></div><p>å½“Shapeç›¸å¯¹Actoræ²¡æœ‰æ—‹è½¬ï¼Œå³<code>Shape.LocalRotation = (0,0,0,1)</code>æ—¶ï¼Œå®¹æ˜“å‘ç°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>PxVec3</span> <span class=nf>GetShapeScale</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>actor</span><span class=p>.</span><span class=n>Scale</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ä½†æ˜¯å½“åŒæ—¶å­˜åœ¨æ—‹è½¬å’Œéå‡åŒ€ç¼©æ”¾å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå½“<code>Actor.Scale=(1,4,1)</code>ï¼Œè€ŒShapeç»•zè½´è½¬äº†90åº¦ï¼Œé‚£ä¹ˆé¢„æœŸçš„ç»“æœåº”è¯¥æ˜¯<code>(4,1,1)</code>ï¼Œå³Shapeç›¸å¯¹äºè‡ªå·±åœ¨æ¨ªå‘ä¸Šæ‰©å¤§åˆ°2å€ã€‚è‹¥ç»•zè½´è½¬äº†45åº¦ï¼Œé‚£ä¹ˆé¢„æœŸçš„ç»“æœæ˜¯<code>(2,2,1)</code>ã€‚è¦å¦‚ä½•è¾¾åˆ°è¿™ç§æ•ˆæœå‘¢ï¼Ÿ</p><h1 id=ä¼¼æ˜¯è€Œéçš„ç®—æ³•>ä¼¼æ˜¯è€Œéçš„ç®—æ³•<a hidden class=anchor aria-hidden=true href=#ä¼¼æ˜¯è€Œéçš„ç®—æ³•>#</a></h1><p>ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯ï¼Œè¦è¾¾åˆ°ä¸Šé¢çš„æ•ˆæœï¼Œå…¶å®æ˜¯å°†<code>Actor.Scale</code>åƒæ–¹å‘çŸ¢é‡é‚£æ ·æ—‹è½¬åˆ°Shapeç©ºé—´å†…ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>PxVec3</span> <span class=nf>GetShapeScale</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>PxTransform</span> <span class=n>shapeSpace</span> <span class=o>=</span> <span class=n>shape</span><span class=o>-&gt;</span><span class=n>getLocalPose</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>shapeSpace</span><span class=o>-&gt;</span><span class=n>rotate</span><span class=p>(</span><span class=n>actor</span><span class=p>.</span><span class=n>Scale</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ç„¶è€Œåä¾‹æ˜¯ï¼š<code>actorScale=(1,1,1)</code>ç»è¿‡æ—‹è½¬åå¯èƒ½ä¸å†æ˜¯<code>(1,1,1)</code>ï¼Œå³Shapeå åŠ äº†ä¸€ä¸ªç¼©æ”¾ã€‚è¿™æ˜¯ä¸äº‹å®è¿èƒŒçš„ã€‚é’ˆå¯¹<code>(1,1,1)</code>ç‰¹æ®Šå¤„ç†ä¹Ÿå¹¶ä¸æ­£ç¡®ï¼Œå› ä¸ºå¯¹äºä»»æ„<code>(X,Y,Z)</code>ï¼Œæ€»æœ‰ä¸€ç§æ—‹è½¬è®©å…¶æŸä¸ªåˆ†é‡ä¸º<code>0</code>ã€‚</p><p>è¿™ç§ç®—æ³•çš„é”™è¯¯ä¹‹å¤„åœ¨æœ€åä¸€èŠ‚ä¼šé¢å¤–è®¨è®ºã€‚</p><h1 id=æ­£ç¡®çš„ç®—æ³•>æ­£ç¡®çš„ç®—æ³•<a hidden class=anchor aria-hidden=true href=#æ­£ç¡®çš„ç®—æ³•>#</a></h1><p>åœ¨<a href=https://docs.unity3d.com/ScriptReference/Transform-lossyScale.html>Unityçš„æ–‡æ¡£</a>ä¸­ï¼Œå¯¹äºTransform.LossyScaleè¿™æ ·è¯´æ˜ï¼š</p><blockquote><p>The global scale of the object (Read Only).</p><p>Please note that if you have a parent transform with scale and a child that is arbitrarily rotated, the scale will be skewed. <code>Thus scale can not be represented correctly in a 3 component vector but only a 3x3 matrix</code>. Such a representation is quite inconvenient to work with however. <code>lossyScale is a convenience property that attempts to match the actual world scale as much as it can</code>. If your objects are not skewed the value will be completely correct and most likely the value will not be very different if it contains skew too.</p></blockquote><p>ç†è§£ï¼Œä½†ä¸å®Œå…¨ç†è§£ã€‚ç›´åˆ°æ‰¾æ¥æºç åˆ†æäº†ä¸€ç•ªã€‚å»ç²—å–ç²¾ï¼Œæ ¹æ®ä»£ç æç‚¼å‡ºå…¬å¼ï¼š</p><p>$$
R_{world}=R_1R_2&mldr;R_N
$$
$$
W_{world}=R_1S_1R_2S_2&mldr;R_NS_N
$$
$$
S_{world}=R_{world}^{-1}W_{world}
$$
$$
s = diag(S_{world})
$$</p><p>ä¸Šå¼ä¸­ï¼Œ\(1&mldr;N\)æ˜¯æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„ç¼–å·ï¼Œæ‰€æœ‰çŸ©é˜µå‡é‡‡ç”¨åˆ—ä¼˜å…ˆçŸ©é˜µï¼ˆå› æ­¤ä½¿ç”¨å·¦ä¹˜ï¼Œä¾‹å¦‚\(R_{world}\)å«ä¹‰æ˜¯å…ˆä½¿ç”¨\(R_N\)è¿›è¡Œå˜æ¢åˆ°çˆ¶ç©ºé—´ï¼Œç„¶åä¾æ¬¡â€¦â€¦ç›´åˆ°ä½¿ç”¨\(R_1\)å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ï¼‰ã€‚\(R_i\)æ˜¯åªåŒ…å«è‡ªèº«æ—‹è½¬ä¿¡æ¯çš„3x3æ—‹è½¬çŸ©é˜µã€‚\(S_i\)æ˜¯åªåŒ…å«è‡ªèº«ç¼©æ”¾ä¿¡æ¯çš„3x3å¯¹è§’çŸ©é˜µã€‚</p><p>æœ€ç»ˆç»“æœ\(s\)æ˜¯3x1åˆ—çŸ¢é‡ï¼Œå–è‡ª\(S_{world}\)çš„å¯¹è§’çº¿å…ƒç´ ã€‚</p><blockquote><p>é™¤äº†å–ä¸»å¯¹è§’çº¿å…ƒç´ ï¼Œè¿˜æœ‰ä¸€ç§è®¡ç®—æ³•æ¥ç¡®å®šæœ€ç»ˆçš„ç¼©æ”¾ç³»æ•°ï¼šå–æ¯ä¸€åˆ—çš„æ¨¡é•¿ä½œä¸ºç³»æ•°ã€‚è¿™ä¸ªåšæ³•çš„ä¼˜ç‚¹æ˜¯ç²¾ç¡®ä¿ç•™äº†æ¯ä¸ªè½´ç¼©æ”¾åçš„é•¿åº¦ï¼Œä¸è¿‡è¿™æ ·éœ€è¦ä¸ºè´Ÿæ•°ç¼©æ”¾å¤šä¸€äº›å¤„ç†ï¼šè®¡ç®—å˜æ¢çš„è¡Œåˆ—å¼ï¼Œå¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™å°†xè½´çš„ç¼©æ”¾æ·»åŠ è´Ÿå·ã€‚</p></blockquote><h1 id=ç®—æ³•æ¨å¯¼ä¸è§£é‡Š>ç®—æ³•æ¨å¯¼ä¸è§£é‡Š<a hidden class=anchor aria-hidden=true href=#ç®—æ³•æ¨å¯¼ä¸è§£é‡Š>#</a></h1><p>ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å‘¢ï¼Ÿè¿™è¦ä»<code>TRS</code>å˜æ¢çŸ©é˜µè¯´èµ·ã€‚åœ¨3Dä¸­é—´ä¸­çš„å§¿æ€ã€è¿åŠ¨å’Œåæ ‡ç³»éƒ½å¯ä»¥ç”¨çŸ©é˜µè¡¨è¾¾ã€‚
ä¸€èˆ¬\(T\)è¡¨ç¤ºä½ç§»ï¼Œ\(R\)è¡¨ç¤ºæ—‹è½¬ï¼Œ\(S\) è¡¨ç¤ºç¼©æ”¾ã€‚</p><blockquote><p>è´´å¿ƒæç¤ºï¼š</p><ul><li>ç”¨æ¬§æ‹‰è§’è¡¨ç¤ºåˆ™éœ€è¦è§„å®šæ—‹è½¬è½´æ¬¡åºå¦åˆ™æœ‰æ­§ä¹‰ï¼ˆæ„Ÿå…´è¶£å¯ä»¥æœç´¢ä¸‡å‘èŠ‚æ­»é”ï¼‰ã€‚ç»è¿‡å®éªŒï¼Œ<strong>Unityä½¿ç”¨YXZ</strong>ï¼Œå³å¯¹äº\((\theta_x,\theta_y,\theta_z)\)ï¼Œå…ˆæŒ‰ç…§Yè½´è½¬ \(\theta_y\) ï¼Œå†æŒ‰ç…§è½¬åŠ¨åçš„Xè½´è½¬\(\theta_x\)ï¼Œå†æŒ‰ç…§è½¬åŠ¨åçš„Zè½´è½¬\(\theta_z\)ã€‚</li><li>æœ‰æ—¶ä½¿ç”¨4x4è€Œä¸æ˜¯3x3çŸ©é˜µåªæ˜¯ä¸€ä¸ªæ•°å­¦ä¸Šçš„æŠ€å·§ï¼Œä¸ºäº†è®©æ‰€æœ‰å˜æ¢éƒ½å¯ä»¥ç”¨çŸ©é˜µä¹˜æ³•ä¸²è”èµ·æ¥ã€‚</li><li>æœ‰æ—¶ä½¿ç”¨åˆ†å—çŸ©é˜µä¹Ÿåªæ˜¯ä¸€ä¸ªæ•°å­¦ä¸Šçš„æŠ€å·§ï¼Œä¸ºäº†ç®€åŒ–å…¬å¼å‘ç°è§„å¾‹ã€‚</li><li>å¯¹äºåˆ—ä¼˜å…ˆçŸ©é˜µï¼Œå°†åˆ—çŸ¢é‡\(v_1\)å…ˆæŒ‰ç…§\(M_1\)å˜æ¢å†æŒ‰ç…§\(M_2\)å˜æ¢åˆ°\(v_2\)ï¼Œå†™ä½œ\(v_2=M_2M_1v_1\)ã€‚</li><li>æ›´å¤šèµ„æ–™è¯·å‚è€ƒã€Š<a href=https://www.gameenginebook.com/>æ¸¸æˆå¼•æ“æ¶æ„</a>ã€‹ã€ä»»ä½•è®²è§£3Dæ¸¸æˆå¼€å‘æˆ–å›¾å½¢å­¦çš„ä¹¦ç±ã€‚</li></ul></blockquote><p>$$
T=
\begin{pmatrix}
1 & 0 & 0 & Tx \\
0 & 1 & 0 & Ty \\
0 & 0 & 1 & Tz \\
0 & 0 & 0 & 1
\end{pmatrix}=
\begin{pmatrix}
I & \bar{T}\\
0 & 0
\end{pmatrix}
$$</p><p>$$
R_x=
\begin{pmatrix}
1 & 0 & 0 & 0 \\
0 & \cos\theta_x & -\sin\theta_x & 0 \\
0 & \sin\theta_x & \cos\theta_x & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$</p><p>$$
R_y=
\begin{pmatrix}
\cos\theta_y & 0 & \sin\theta_y & 0 \\
0 & 1 & 0 & 0 \\
-\sin\theta_y & 0 & \cos\theta_y & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$</p><p>$$
R_z=
\begin{pmatrix}
\cos\theta_z & -\sin\theta_z & 0 & 0 \\
\sin\theta_z & \cos\theta_z & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}
$$</p><p>$$
R = R_zR_xR_y=
\begin{pmatrix}
r_{11} & r_{12} & r_{13} & 0 \\
r_{21} & r_{22} & r_{23} & 0 \\
r_{31} & r_{32} & r_{33} & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}=
\begin{pmatrix}
\bar{R} & 0 \\
0 & 1
\end{pmatrix}
$$</p><p>$$
S=
\begin{pmatrix}
s_x & 0 & 0 & 0 \\
0 & s_y & 0 & 0 \\
0 & 0 & s_z & 0 \\
0 & 0 & 0 & 1
\end{pmatrix}=
\begin{pmatrix}
\bar{S} & 0 \\
0 & 1
\end{pmatrix}
$$</p><p>åˆ™å¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå…¶æœ¬åœ°åæ ‡ç³»çš„TRSå˜æ¢çŸ©é˜µå¯ä»¥å†™ä½œï¼š</p><p>$$
M=\begin{pmatrix}
r_{11}S_x & r_{12}S_y & r_{13}S_z & T_x \\
r_{21}S_x & r_{22}S_y & r_{23}S_z & T_y \\
r_{31}S_x & r_{32}S_y & r_{33}S_z & T_z \\
0 & 0 & 0 & 1
\end{pmatrix}=
\begin{pmatrix}
\bar{R}\bar{S} & \bar{T} \\
0 & 1
\end{pmatrix}
$$</p><p>å¯¹äºçˆ¶å­èŠ‚ç‚¹\(M_1\)ä¸‹çš„å­èŠ‚ç‚¹\(M_2\)åæ ‡ç³»ï¼Œå…¶ç›¸å¯¹äºä¸–ç•Œåæ ‡ç³»çš„å˜æ¢çŸ©é˜µå¯ä»¥å†™ä½œï¼š</p><p>$$
M_{world}=M_1M_2=
\begin{pmatrix}
\bar{R_1}\bar{S_1} & \bar{T_1} \\
0 & 1
\end{pmatrix}
\begin{pmatrix}
\bar{R_2}\bar{S_2} & \bar{T_2} \\
0 & 1
\end{pmatrix}=
\begin{pmatrix}
\bar{R_1}\bar{S_1}\bar{R_2}\bar{S_2} & \bar{R_1}\bar{S_1}\bar{T_2}+\bar{T_1} \\
0 & 1
\end{pmatrix}
$$</p><h2 id=æ€è·¯1>æ€è·¯1<a hidden class=anchor aria-hidden=true href=#æ€è·¯1>#</a></h2><p>ä»å¦ä¸€ä¸ªè§’åº¦æ€è€ƒï¼Œè‹¥è¦å°†\(M_{world}\)æ‹†åˆ†æˆTRSä¸‰ä¸ªåˆ†é‡ï¼Œæ˜¯å¦å°±å¯¹åº”ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ä½ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ï¼ˆå…¨å±€ç¼©æ”¾æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼‰å‘¢ï¼Ÿå®¹æ˜“è§‚å¯Ÿåˆ°å…¨å±€ä½ç§»æ˜¯ï¼š</p><p>$$
T_{world}=
\begin{pmatrix}
\bar{R_1}\bar{S_1}\bar{T_2}+\bar{T_1}
\end{pmatrix}
$$</p><p>è€Œå…¨å±€æ—‹è½¬ç”±äºå…¶ç‰©ç†æ„ä¹‰ï¼Œå¿…ç„¶æ˜¯ï¼š</p><p>$$
R_{world}= \bar{R_1}\bar{R_2}
$$</p><p>åˆ™å…¨å±€ç¼©æ”¾åªèƒ½æ˜¯ï¼š</p><p>$$
S_{world}=R_{world}^{-1}=(\bar{R_1}\bar{S_1}\bar{R_2}\bar{S_2})=(\bar{R}_2^{-1}\bar{S_1}\bar{R_2})\bar{S_2}
$$</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œ\(S_{world}\)æ˜¯ä¸€ä¸ªéå¯¹è§’çŸ©é˜µï¼Œå³ä¸»å¯¹è§’çº¿ä¹‹å¤–ä¹Ÿæœ‰éé›¶å€¼ã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦ç†è§£ï¼Œå°†å­ç©ºé—´çš„æ ‡å‡†æ­£äº¤åŸºå˜æ¢åˆ°çˆ¶ç©ºé—´åï¼Œè¿™ç»„åŸºé™¤äº†æ¨¡é•¿å‘ç”Ÿäº†å˜æ¢ï¼Œä¹Ÿä¸å†ä¸¤ä¸¤å‚ç›´äº†â€”â€”è¿™ä¹Ÿå«å­èŠ‚ç‚¹å‘ç”Ÿäº†å‰ªåˆ‡ï¼ˆShearï¼‰ã€‚å½“æˆ‘ä»¬åªç”¨ä¸€ä¸ªä¸‰ç»´åˆ†é‡è¡¨ç¤ºç¼©æ”¾æ—¶ï¼ŒåŠ¿å¿…è¦ä¸¢å¤±è¿™ç»„åŸºä¹‹é—´çš„å¤¹è§’ä¿¡æ¯ï¼Œè¿™ä¹Ÿæ˜¯<code>LossyScale</code>åå­—çš„ç”±æ¥ã€‚åªæœ‰å½“çˆ¶èŠ‚ç‚¹æ˜¯å‡åŒ€ç¼©æ”¾ï¼ˆ\(\bar{S_1}=s_1I\)ï¼‰ã€æˆ–å­èŠ‚ç‚¹æ²¡æœ‰ç›¸å¯¹æ—‹è½¬ï¼ˆ\(\bar{R_2}=I\)ï¼‰æ—¶ï¼Œå…¨å±€ç¼©æ”¾ç³»æ•°å¯ä»¥åŒ–ç®€ä¸º\(S_{world}=\bar{S_1}\bar{S_2}=[s_x,s_y,s_z]^T\)ï¼Œå…¶æ˜¯ä¸€ä¸ªå¯¹è§’çŸ©é˜µï¼Œå³<code>LossyScale</code>åŒ…å«äº†å®Œæ•´çš„ç¼©æ”¾ä¿¡æ¯ã€‚</p><h2 id=æ€è·¯2>æ€è·¯2<a hidden class=anchor aria-hidden=true href=#æ€è·¯2>#</a></h2><p>é™¤äº†ä¸Šé¢å‡‘å‡º\(S_{world}\)è¿›è€Œå¾—åˆ°ç¼©æ”¾ç³»æ•°çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç§æ€è·¯ç›´æ¥æ±‚å¾—ç»“æœã€‚</p><p>ä¸Šé¢å·²ç»çŸ¥é“ï¼Œå…¨å±€å˜æ¢çŸ©é˜µä¸ºï¼š
$$
M_{world}=
\begin{pmatrix}
\bar{R_1}\bar{S_1}\bar{R_2}\bar{S_2} & \bar{R_1}\bar{S_1}\bar{T_2}+\bar{T_1} \\
0 & 1
\end{pmatrix}
$$</p><p><strong>â€œå…¨å±€ç¼©æ”¾ç³»æ•°â€çš„å®šä¹‰æœ¬è´¨ä¸Šå°±æ˜¯ï¼šå­èŠ‚ç‚¹çš„æœ¬åœ°å•ä½è½´ï¼Œç»è¿‡å±‚å±‚å˜æ¢åï¼Œåœ¨ä¸–ç•Œç©ºé—´ä¸­å˜æˆäº†å¤šé•¿</strong>ã€‚å› æ­¤å¯ä»¥å¿½ç•¥å¹³ç§»éƒ¨åˆ†ï¼Œåªçœ‹å˜æ¢ï¼š
$$
L = \bar{R_1}\bar{S_1}\bar{R_2}\bar{S_2}
$$</p><p>ä»¥å­èŠ‚ç‚¹æœ¬åœ°çš„xè½´åŸºå‘é‡\(e_x = (1,0,0)^T\)ä¸ºä¾‹ï¼Œå…¶ç»è¿‡\(L\)å˜æ¢åï¼Œæ¨¡é•¿æ˜¯ï¼š
$$
s_{world, x} = ||L \cdot e_x|| = ||\bar{R_1}\bar{S_1}\bar{R_2}\bar{S_2} \cdot e_x||
$$</p><p>æœ€åä¸€æ¬¡æ—‹è½¬\(\bar{R_1}\)ä¸æ”¹å˜æ¨¡é•¿ï¼Œç›´æ¥å¯å¾—ï¼š</p><p>$$
s_{world, x} = s_{2,x} \cdot \sqrt{(r_{2,11} \cdot s_{1,x})^2 + (r_{2,21} \cdot s_{1,y})^2 + (r_{2,31} \cdot s_{1,z})^2}
$$</p><h1 id=é—®é¢˜çš„ç»ˆç»“>é—®é¢˜çš„ç»ˆç»“<a hidden class=anchor aria-hidden=true href=#é—®é¢˜çš„ç»ˆç»“>#</a></h1><p>å›åˆ°æœ€åˆçš„é—®é¢˜ä¸Šæ¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨å’ŒUnityä¸€æ ·çš„å–ä¸»å¯¹è§’çº¿å…ƒç´ æ³•è€Œæ²¡æœ‰é€‰å–æ¨¡æ³•ã€‚å¯¹Actorè®¾ç½®ç¼©æ”¾æ—¶è¦æ›´æ–°æ‰€å±Shapeçš„å°ºå¯¸ï¼Œä¸ºæ­¤è¦å®ç°çš„<code>GetShapeScale()</code>å®Œæ•´ç‰ˆï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Shape</span><span class=p>.</span><span class=n>Dimension</span> <span class=o>=</span> <span class=n>Shape</span><span class=p>.</span><span class=n>OriginalDimension</span> <span class=o>*</span> <span class=n>GetShapeScale</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PhysXVec3</span> <span class=nf>GetShapeScale</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>PxQuat</span> <span class=n>worldRot</span> <span class=o>=</span> <span class=n>actor</span><span class=p>.</span><span class=n>Rotation</span> <span class=o>*</span> <span class=n>shapeTransform</span><span class=p>.</span><span class=n>q</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PxMat33</span> <span class=n>inverseWorldRotMat</span> <span class=o>=</span> <span class=n>PxMat33</span><span class=p>(</span><span class=n>worldRot</span><span class=p>.</span><span class=n>getConjugate</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>PxMat33</span> <span class=n>localRotMat</span> <span class=o>=</span> <span class=n>PxMat33</span><span class=p>(</span><span class=n>shapeTransform</span><span class=p>.</span><span class=n>q</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>PxMat33</span> <span class=n>actorRotMat</span> <span class=o>=</span> <span class=n>PxMat33</span><span class=p>(</span><span class=n>actor</span><span class=p>.</span><span class=n>Rotation</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>PxMat33</span> <span class=n>actorScaleMat</span> <span class=o>=</span> <span class=n>PxMat33</span><span class=p>().</span><span class=n>createDiagonal</span><span class=p>(</span><span class=n>actor</span><span class=p>.</span><span class=n>Scale</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>PxMat33</span> <span class=n>worldRotAndScaleMat</span> <span class=o>=</span> <span class=n>actorRotMat</span> <span class=o>*</span> <span class=n>actorScaleMat</span> <span class=o>*</span> <span class=n>localRotMat</span> <span class=cm>/* * localScaleMat*/</span><span class=p>;</span> <span class=c1>// localScaleMat is always Identity Matrix, so we omit it
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>PxMat33</span> <span class=n>worldScaleMat</span> <span class=o>=</span> <span class=n>inverseWorldRotMat</span> <span class=o>*</span> <span class=n>worldRotAndScaleMat</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>PhysXVec3</span> <span class=n>worldscale</span> <span class=o>=</span> <span class=n>PhysXVec3</span><span class=p>(</span><span class=n>worldScaleMat</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span> <span class=n>worldScaleMat</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span> <span class=n>worldScaleMat</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// can have extra logic to make sure all values in worldscale are non-zero
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>worldscale</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=é¢å¤–çš„è®¨è®º>é¢å¤–çš„è®¨è®º<a hidden class=anchor aria-hidden=true href=#é¢å¤–çš„è®¨è®º>#</a></h1><p>å·²çŸ¥æ­£ç¡®çš„ç®—æ³•æ˜¯ï¼š</p><p>$$
S_{world}=(\bar{R}_2^{-1}\bar{S_1}\bar{R_2})\bar{S_2}
$$</p><p>è€Œä¼¼æ˜¯è€Œéçš„ç®—æ³•å…¶å®æ˜¯ï¼š</p><p>$$
S_{world}=(\bar{R_2}s_1)\bar{S_2}
$$</p><p>æœ¬è´¨é”™è¯¯åœ¨äºï¼š</p><ul><li>æ­£ç¡®çš„ç®—æ³•æ˜¯å°†ç¼©æ”¾æœ¬èº«è§†ä¸ºä¸€ä¸ªç©ºé—´å˜æ¢\(S_1\)ï¼Œè¿›è¡Œ<strong>åŸºå˜æ¢</strong>ã€‚</li><li>é”™è¯¯çš„ç®—æ³•æ˜¯å°†ç¼©æ”¾ç³»æ•°è§†ä¸ºä¸€ä¸ªæ™®é€šçŸ¢é‡\(s_1\) ï¼Œè¿›è¡Œ<strong>ç©ºé—´å˜æ¢</strong>ã€‚</li></ul><p>è¿™äº›åœ¨å¤§ä¸€çš„è¯¾å ‚ä¸Šæ—©å·²å­¦è¿‡ã€‚å¾€å¾€æ­£å‘è§£é‡Šå¾ˆç®€å•ï¼Œéš¾çš„æ˜¯åå‘æ€è€ƒï¼Œå³é‡åˆ°å®é™…é—®é¢˜æ€ä¹ˆé€‰æ‹©åˆé€‚çš„æ¦‚å¿µå»è§£å†³ã€‚</p><blockquote><p>çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://pps43.github.io/tags/game-dev/>Game Dev</a></li><li><a href=https://pps43.github.io/tags/physx/>PhysX</a></li><li><a href=https://pps43.github.io/tags/%E6%95%B0%E5%AD%A6/>æ•°å­¦</a></li></ul><nav class=paginav><a class=prev href=https://pps43.github.io/posts/using_physx_collision/><span class=title>Â« Prev</span><br><span>PhysXç‰©ç†å¼•æ“ï¼ˆ2ï¼‰Collision</span>
</a><a class=next href=https://pps43.github.io/posts/notes_on_genius_in_ghibli/><span class=title>Next Â»</span><br><span>å‰åœåŠ›çš„å¤©æ‰ä»¬ï¼ˆé“ƒæœ¨æ•å¤«ï¼‰</span></a></nav></footer></article></main><footer class=footer><span>Â© 2016-2023 By æ³¢æ³¢æ²™.</span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>