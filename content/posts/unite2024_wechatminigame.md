---
title: "ç®¡ä¸­çª¥è±¹ï¼šé€è¿‡Unityå¾®ä¿¡å°æ¸¸æˆçœ‹.NET8"
date: 2024-07-28
draft: false
tags: ["WebGL", "IL2CPP", "Game Dev", "Unity", ".NET"]
hideSummary: false
---

> å‰å‡ æ—¥å‚åŠ äº†Uniteä¸Šæµ·2024ï¼Œå—ç›Šé¢‡å¤šã€‚æœ¬ç¯‡å…ˆå°±ç›¸å¯¹æ„Ÿå…´è¶£çš„å°æ¸¸æˆå¹³å°WebGLæŠ€æœ¯æ–¹æ¡ˆä¸ºå¼•å­ï¼Œå¼•å‡ºä¸€äº›å…³äºWebAssembly, IL2CPP, ä»¥åŠ.NET 8å¯¹Webå¹³å°æ”¯æŒç­‰è¯é¢˜ã€‚

# ä»€ä¹ˆæ˜¯WebGL
- é’ˆå¯¹Webçš„3Då›¾å½¢APIæ ‡å‡†ï¼Œç±»ä¼¼é’ˆå¯¹ç§»åŠ¨è®¾å¤‡çš„`OpenGL ES`ã€‚
- æ¡Œé¢å¹³å°å’Œç§»åŠ¨å¹³å°éƒ½æœ‰å®ç°ï¼Œå¦‚æµè§ˆå™¨ï¼Œä½†æ”¯æŒç¨‹åº¦ä¸åŒã€‚
- [WebGL Wiki](https://www.khronos.org/webgl/wiki/Main_Page)
- [WebGL Tutorial](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Tutorial)

WebGL1.0å‡ºç°å‰ï¼ŒWebä¸­çš„å›¾å½¢æ¸²æŸ“æ–¹å¼ä¸»è¦æœ‰ï¼š`HTML+CSS`, `SVG`, ~~`Flash`~~, `H5 Canvas API`ã€‚WebGL2.0ä»¥åçš„å‘å±•è¶‹åŠ¿æ˜¯WebGPUï¼ˆç±»æ¯”`Vulkan`ï¼‰ã€‚

# ä»€ä¹ˆæ˜¯WebAssembly
- ä¸€å¥—è·¨ç¡¬ä»¶å¹³å°çš„è™šæ‹ŸæŒ‡ä»¤é›†/äºŒè¿›åˆ¶ä»£ç æ ¼å¼ï¼Œç±»æ¯”æ±‡ç¼–è¯­è¨€`Assembly`ã€‚
- åŒ…å«ç³»ç»Ÿæ¥å£è§„èŒƒ`WASI`ï¼Œç±»ä¼¼`ABI`ï¼Œ`API`ã€‚
- è¿è¡Œåœ¨æ²™ç›’ç¯å¢ƒã€‚

WebAssemblyç®€ç§°`.wasm`ã€‚ç›®å‰CPUè¿˜ä¸èƒ½ç›´æ¥æ‰§è¡Œwasmä»£ç ï¼Œè€Œæ˜¯é€šè¿‡ä¸€äº›è¿è¡Œæ—¶è§£é‡Šæ‰§è¡Œã€‚å¸¸è§è¿è¡Œæ—¶æœ‰ï¼šæµè§ˆå™¨ä¸­çš„è„šæœ¬å¼•æ“ï¼ˆå¦‚`V8`ï¼Œ` JSCore`ï¼‰ã€`iwasm`ã€`wasmtime`ã€`wasmer`.â€¦â€¦æœ€å¥½çš„è¿è¡Œæ—¶æ‰§è¡Œwasmçš„é€Ÿåº¦åªæ¯”Cç¨‹åºæ…¢1.5~3å€ã€‚

[V8](https://v8.dev/)åŒæ—¶æ”¯æŒjså’Œwasmçš„è¿è¡Œï¼Œä½†è§£æã€ç¼–è¯‘ã€æ‰§è¡Œæ˜¯ç‹¬ç«‹çš„æ¨¡å—ã€‚ä¸¤ç§è¯­è¨€å¯ä»¥é€šè¿‡å…±äº«å†…å­˜æ¥é«˜æ•ˆä¼ é€’æ•°æ®ã€‚Chromeæµè§ˆå™¨å’ŒNodeJSçš„è„šæœ¬å¼•æ“éƒ½æ˜¯V8ã€‚ç”±äºFEåŸºäºçš„Electronå†…ç½®äº†NodeJSä½œä¸ºbackendï¼Œæ‰€ä»¥ä¹Ÿç”¨çš„æ˜¯V8ã€‚

é«˜çº§è¯­è¨€å¯ä»¥ç¼–è¯‘æˆwasmï¼Œæˆ–è¿è¡Œåœ¨æ„å»ºåœ¨wasmä¹‹ä¸Šçš„è¿è¡Œæ—¶ä¸­ï¼ˆå¦‚C#é€šè¿‡dotnet wasm runtimeå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼‰ã€‚
```mermaid
flowchart LR
C(C/C++)-->|emscripten| wasm
CS(C#)-->|.net wasi| wasm
CS-->|IL2CPP| C
CS-.->|dotnet wasm runtime|wasm
Go-->wasm
```

## WebAssemblyå¦‚ä½•è°ƒç”¨WebGLæ¸²æŸ“
- WebAssemblyç›®å‰ç¼ºå°‘ç›´æ¥è°ƒç”¨WebAPIçš„èƒ½åŠ›ï¼Œæ‰€ä»¥éœ€è¦å’ŒJSäº’æ“ä½œæ¥æ‰§è¡Œæ¸²æŸ“æŒ‡ä»¤ã€‚
- éœ€è¦WASIå¢åŠ å¯¹å›¾å½¢æ¸²æŸ“æ¥å£çš„è§„å®šï¼ˆç›®å‰ä¸»è¦è§„å®šæ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œç›¸å…³ï¼‰ã€‚

# ä¸ºä»€ä¹ˆå…³æ³¨WebGL+WebAssembly
- Unityæ”¯æŒå¯¼å‡ºwebå¹³å°çš„æŠ€æœ¯æ ˆæ˜¯WebGL+WebAssemblyï¼Œæˆ‘ä»¬çš„UGCç¼–è¾‘å™¨å†…ç½®çš„æ¸¸æˆå®¢æˆ·ç«¯æ­£æ˜¯è¯¥æ–¹æ¡ˆã€‚åæ–‡å°†è¯¥æŠ€æœ¯æ ˆåˆç§°ä¸º`Unity WebGL`ã€‚
- Unity WebGLçš„æŸäº›æ€§èƒ½ä¼˜åŒ–æ€è·¯ï¼ˆåŒ…ä½“ã€å†…å­˜å ç”¨ç­‰ï¼‰å¯¹Appä¹Ÿæœ‰å€Ÿé‰´ä½œç”¨ã€‚
- å°æ¸¸æˆæ­£åœ¨å…´èµ·ï¼ŒUnity WebGLæ˜¯ä¸€ä¸ªé‡è¦æ–¹æ¡ˆï¼Œå€¼å¾—å…³æ³¨ã€‚

# Unity WebGLæ–¹æ¡ˆä»‹ç»

- C#è„šæœ¬é€šè¿‡`C# -> (IL2CPP) -> C/C++ -> (Emscripten) --> wasm`æœ€ç»ˆè¢«åŒ…å«åœ¨åŒ…å†…ã€‚
- ä¸‰æ–¹æ’ä»¶å’ŒåŸç”Ÿæ’ä»¶ä¹Ÿå¤ç”¨ä¸Šè¿°éƒ¨åˆ†æµç¨‹ã€‚
- è¿è¡Œæ—¶çš„Unityå †å†…å­˜ï¼ˆåŒ…æ‹¬æ‰˜ç®¡å’Œéæ‰˜ç®¡å¯¹è±¡ã€åŠ è½½çš„èµ„æºã€åœºæ™¯ã€Shaderç­‰ï¼‰æ˜¯ä¸€ä¸ª`WebAssembly.Memory`å¯¹è±¡ï¼Œåº•å±‚æ˜¯`ArrayBuffer`ï¼Œå†…å­˜è¿ç»­ã€å¯æ‰©å®¹ã€‚
    >å°½é‡ä¸è¦åŠ¨æ€æ‰©å®¹ï¼Œä¼šé€ æˆå†…å­˜å°–å³°ï¼Œéå¸¸å®¹æ˜“è¶…å‡ºå¹³å°å†…å­˜é™åˆ¶è€ŒCrashï¼ˆiOSåœ¨è¿›ç¨‹å†…å­˜è¶…è¿‡1.4Gåé«˜æ¦‚ç‡Crashï¼‰ã€‚å»ºè®®ä¼‘é—²æ¸¸æˆé¢„ç•™256MBã€‚


##  Unity WebGLæ–¹æ¡ˆçš„é™åˆ¶
Unity WebGLæœ€ä¸»è¦çš„åŠŸèƒ½é™åˆ¶æ˜¯**ç½‘ç»œã€æ–‡ä»¶**ï¼Œæœ€ä¸»è¦çš„ç“¶é¢ˆï¼ˆç§»åŠ¨ç«¯å°¤ç”šï¼‰æ˜¯**å†…å­˜ã€CPU**ã€‚å…·ä½“æ¥è¯´å¯åˆ†ä¸ºå¹³å°å›ºæœ‰é™åˆ¶å’ŒæŠ€æœ¯é™åˆ¶ã€‚

å¹³å°å›ºæœ‰é™åˆ¶
- ä¸æ”¯æŒC#å¤šçº¿ç¨‹ï¼Œæ˜¯Webå›ºæœ‰é™åˆ¶ã€‚
- ä¸æ”¯æŒSIMDï¼Œæ˜¯Webå›ºæœ‰é™åˆ¶ã€‚
    > è’™çš®ä¼šæ˜¾è‘—å˜æ…¢ã€‚
- å½“é¡µé¢å¤±å»ç„¦ç‚¹æˆ–ä¸å¯è§æ—¶ï¼Œå¯èƒ½è¢«å¼ºåˆ¶é™åˆ¶è¿è¡Œï¼ˆ1FPSï¼‰ï¼Œæ˜¯Webå›ºæœ‰é™åˆ¶ã€‚
- ä¸æ”¯æŒsocketç½‘ç»œç¼–ç¨‹ï¼Œæ˜¯Webå›ºæœ‰é™åˆ¶ã€‚ç”¨`UnityWebRequest`ï¼ˆåŸºäºJS Fetch APIï¼‰æˆ–`WebSockets/WebRTC`ã€‚
- ä¸æ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè¯»å†™ï¼Œæ˜¯Webå›ºæœ‰é™åˆ¶ã€‚Unityä½¿ç”¨çš„Emscriptenä¼šåœ¨å†…å­˜ä¸­æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶é€šè¿‡`Data caching`å’Œ`IndexedDB API`æ¯éš”1sä¿å­˜æ•°æ®åˆ°æœ¬åœ°ã€‚
    > æ³¨æ„åŠæ—¶æ¸…é™¤ä¸‹è½½ã€è§£å‹åä¸å¿…è¦çš„æ–‡ä»¶ï¼Œå‡å°‘å†…å­˜å‹åŠ›ã€‚
    > 
    > æ— æ³•è°ƒç”¨ç³»ç»Ÿå­—ä½“ï¼Œéœ€è¦è‡ªå¸¦å­—ä½“èµ„æºã€‚
- GCåªåœ¨å¸§å°¾æ‰æ‰§è¡Œï¼Œæ˜¯WebAssemblyå®‰å…¨é™åˆ¶ï¼šä¸å…è®¸ç”¨æˆ·ä»£ç æŸ¥è¯¢æ‰§è¡Œå †æ ˆã€‚
    > ä¸è¦åœ¨ä¸€å¸§å†…æ„é€ å¤§é‡ä¸´æ—¶å¯¹è±¡ï¼Œå¦åˆ™é€ æˆå†…å­˜ä¸å¤Ÿè€ŒCrashæˆ–GCå‹åŠ›è¿‡å¤§ã€‚
- [æ¸²æŸ“é™åˆ¶](https://docs.unity3d.com/Manual/webgl-graphics.html)ã€‚
- [éŸ³æ•ˆé™åˆ¶](https://docs.unity3d.com/Manual/webgl-audio.html)ã€‚

å…³äºå†…å­˜æ¶ˆè€—ï¼ŒWebGLä¼šæ¯”åŸç”Ÿå¹³å°å¤šå¾—å¤šã€‚ä¸‹å›¾çœ‹åˆ°ä¸»è¦æ¥è‡ªWebAssemblyçš„åŠ è½½ï¼ˆ340MBï¼‰ã€ç¼–è¯‘å’Œå †å†…å­˜ç©ºéš™ï¼ˆ90MBï¼‰ï¼Œä»¥åŠæ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆ60MBï¼‰ã€‚
![iOS WebGLå†…å­˜æ¶ˆè€—](https://docs.unity.cn/cn/tuanjiemanual/uploads/doc_img/WebGLPlatform/memory_compare.png)

æŠ€æœ¯é™åˆ¶
- ä¸æ”¯æŒä»£ç åŠ¨æ€ç”Ÿæˆï¼Œå› ä¸ºè¯¥æ–¹æ¡ˆä¾èµ–IL2CPPã€‚
- æš‚ä¸æ”¯æŒç§»åŠ¨ç«¯ï¼ˆè¿˜æœªé’ˆå¯¹ç§»åŠ¨å¹³å°ä¼˜åŒ–ï¼Œå¯¼è‡´åŸºæœ¬ä¸å¯ç”¨ï¼‰ï¼ŒUnity6åæ”¯æŒã€‚
- æš‚ä¸æ”¯æŒcompute shaderã€‚
- æš‚ä¸æ”¯æŒC#ä»£ç è°ƒè¯•ã€‚



# å¾®ä¿¡å°æ¸¸æˆå¹³å°ä»‹ç»

ğŸŸ¡todo

## å¾®ä¿¡å°æ¸¸æˆå¦‚ä½•æ”¯æŒUnity WebGL
1. å¼€å‘æœŸï¼šæä¾›C# SDKå¯¹æ¥å¹³å°èƒ½åŠ›
2. å¯¼å‡ºæœŸï¼šæä¾›æ‰“åŒ…å·¥å…·ï¼Œå¯¹Unity WebGLè½¬æ¢ä¸ºå°æ¸¸æˆåŒ…
3. è¿è¡ŒæœŸï¼šæä¾›WebAssemblyåŸºç¡€èƒ½åŠ›ï¼Œè„šæœ¬å¼•æ“åœ¨å®‰å“ä¸Šä¸ºV8ï¼ŒiOSä¸Šä¸ºJSCoreã€‚

![å®˜æ–¹ç¤ºæ„å›¾](https://wechat-miniprogram.github.io/minigame-unity-webgl-transform/assets/summary1.B7mzdmu-.png)

å…·ä½“åŠŸèƒ½ä¸Šï¼Œå¾®ä¿¡çš„SDKæä¾›äº†ä¸€äº›èƒ½åŠ›ä»¥æ”¾å®½[[#Unity WebGLæ–¹æ¡ˆçš„é™åˆ¶]]ã€‚å¦‚ï¼š
- æä¾›äº†UDPã€‚
- æä¾›äº†èµ„æºæœ¬åœ°ç¼“å­˜æœºåˆ¶ï¼Œé™åˆ¶ä¸º200MBï¼Œå¯ç”³è¯·1GBã€‚
- æä¾›äº†è®¿é—®å¾®ä¿¡å­—ä½“çš„æ–¹æ³•ã€‚
- æä¾›äº†[æ–‡ä»¶ç³»ç»Ÿå’Œç®¡ç†æœºåˆ¶](https://developers.weixin.qq.com/minigame/dev/guide/base-ability/file-system.html)ï¼Œå¹¶åˆ‡æ–­äº†JSæ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿå†™å…¥IndexDBã€‚


[å°æ¸¸æˆå¯åŠ¨æµç¨‹ä¸æ—¶åº](https://wechat-miniprogram.github.io/minigame-unity-webgl-transform/Design/Startup.html)ï¼ŒUnity Loaderå·¥ä½œæµç¨‹å›¾å¦‚ä¸‹ï¼š
![Unity Loader](https://wechat-miniprogram.github.io/minigame-unity-webgl-transform/assets/launch.DesekVa-.png)




# å›¢ç»“å¼•æ“WebGLæ–¹æ¡ˆä»‹ç»

ä¸¤æ¡è…¿èµ°è·¯ï¼šæ”¹è¿›åŸUnity WebGLæ–¹æ¡ˆï¼›å¼€è¾ŸDotnetRuntimeæ–¹æ¡ˆã€‚
ä¸ç®¡å“ªç§æ–¹æ¡ˆï¼Œç€åŠ›ç‚¹éƒ½åœ¨äºï¼š**å‡å°‘åŒ…ä½“å¤§å°ã€å‡å°‘å†…å­˜å ç”¨ã€åŠ å¿«åŠ è½½æ—¶é—´ã€æå‡å¼€å‘ä½“éªŒ**ã€‚

> ä¾‹å¦‚å°±åŒ…ä½“å¤§å°è€Œè¨€ï¼Œå›¢ç»“å¼•æ“ç‰ˆæœ¬é™ä½ä¸ºUnity WebGLçš„80%ã€‚å¦‚æœä½¿ç”¨DotnetRuntimeæ–¹æ¡ˆï¼Œä¸º60%ã€‚[å‡ºå¤„](https://unity.cn/instantgame/docs/WechatMinigame/InstallUnityWithTuanjieBackport/)ã€‚

![å¾®ä¿¡å°æ¸¸æˆå†…å­˜æ¶ˆè€—åˆ†å¸ƒ]()

## å¯¹Unity WebGLæ–¹æ¡ˆçš„æ”¹è¿›

å¯¹IL2CPPçš„æ”¹è¿›ï¼Œä¼˜åŒ–åŠ è½½æ—¶é—´ã€å†…å­˜å ç”¨å’ŒåŒ…ä½“å¤§å°ã€‚
- å»¶è¿ŸåŠ è½½ç±»å‹å¯¹åº”çš„å…ƒæ•°æ®ï¼Œä¼˜åŒ–å†…å­˜å ç”¨ã€‚
    - IL2CPPé™¤äº†æ˜¯è½¬è¯‘å·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ï¼ˆè™šæ‹Ÿæœºï¼‰ã€‚è¯¥è¿è¡Œæ—¶çš„å†…å­˜æ¶ˆè€—ä¸»è¦æ¥è‡ªC#ä»£ç çš„å…ƒæ•°æ®`global-metadata.dat`ã€‚ç»å®æµ‹ï¼Œå®é™…ç”¨åˆ°çš„å…ƒæ•°æ®åªå å¾ˆå°ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥å»¶è¿ŸåŠ è½½ã€‚14MBçš„æ–‡ä»¶éœ€è¦60+MBå†…å­˜ï¼Œä¼˜åŒ–åå˜ä¸º30MBã€‚
    - ![å»¶è¿ŸåŠ è½½ç¤ºæ„](https://unity.cn/instantgame/docs/assets/images/il2cpp_lazy-7af66dfe51f769fb240bbb2581150977.png)
- ç²¾ç®€äº†ç”Ÿæˆå¼‚å¸¸å¤„ç†ä»£ç ç›¸å…³éƒ¨åˆ†ï¼Œä¼˜åŒ–åŒ…ä½“å¤§å°ã€‚
- ç²¾ç®€äº†å…ƒæ•°æ®ç”Ÿæˆæ•°é‡ã€‚`global-metadata.dat`å¯ç¼©å‡15%ä¼˜åŒ–å†…å­˜å ç”¨å’ŒåŒ…ä½“å¤§å°ã€‚
- åˆå§‹åŒ–genericæ–¹æ³•è¡¨æ—¶ï¼ŒæŠŠHashMapæ”¹ä¸ºæ•°ç»„ï¼Œå¯èŠ‚çœ20%åˆå§‹åŒ–æ—¶é—´ã€‚

å¯¹ä»£ç å‰ªè£çš„æ”¹è¿›ï¼Œä¼˜åŒ–å†…å­˜å ç”¨å’ŒåŒ…ä½“å¤§å°ã€‚
- æä¾›`Extreme`æ¨¡å¼ï¼Œå‡½æ•°çº§å‰”é™¤æœªè¢«è°ƒç”¨çš„ç”¨æˆ·ä»£ç ã€‚
- å‰ªè£å¼•æ“åŠŸèƒ½ï¼Œæ‰“åŒ…æ—¶å½»åº•å‰”é™¤æœªè¢«ä½¿ç”¨çš„åŠŸèƒ½ã€‚

å¯¹è’™çš®æ•ˆç‡çš„æ”¹è¿›ï¼Œä¼˜åŒ–CPUè´Ÿè½½ã€‚
- ä½¿ç”¨[`WebAssembly SIMD`](https://github.com/WebAssembly/simd)é‡å†™äº†WebGLä¸‹çš„UnityMathåº“ã€‚
- å®ç°äº†åŸºäºtransform feedbackçš„GPU Skinningã€‚ä¸å¯å’Œä¸Šè¿°ç‰¹æ€§å…±ç”¨ã€‚

å¯¹ç²’å­ç³»ç»Ÿçš„æ”¹è¿›ï¼Œä¼˜åŒ–å†…å­˜å ç”¨ã€‚
- ä¼˜åŒ–DynamicVBOç¼“å­˜æ± ç­–ç•¥ï¼Œä¼˜åŒ–æ˜¾å­˜å ç”¨ã€‚

å¯¹Shaderå˜ä½“è§£å‹ç­–ç•¥çš„æ”¹è¿›ï¼Œä¼˜åŒ–å†…å­˜å ç”¨ã€‚
- åŸæ¥ä¼šè§£å‹æ‰€æœ‰blobæ•°æ®å¹¶åŠ è½½æ‰€æœ‰å˜ä½“ï¼Œæ”¹ä¸ºåªè§£å‹blobè¡¨å¤´å¹¶æŒ‰éœ€åŠ è½½Shaderå˜ä½“å¯¹åº”çš„blobã€‚

å¯¹å†…å­˜åˆ†é…å™¨çš„æ”¹è¿›ï¼Œä¼˜åŒ–å†…å­˜å ç”¨å’ŒCPUã€‚ä»…ç”¨äºå¾®ä¿¡å°æ¸¸æˆå¹³å°ã€‚
- ä¸å†è®°å½•æ¯æ¬¡åˆ†é…å¤§å°ã€‚
- å°†å†…å­˜å¯¹é½ä»16Bæ”¹ä¸º4Bã€‚

å¯¹InstanceIDå’ŒGUIDæ˜ å°„å…³ç³»çš„ä¿®æ”¹ï¼Œä¼˜åŒ–å†…å­˜å ç”¨ã€‚
- InstanceIDåˆ©ç”¨ç‡æå‡ã€‚
- æŠŠHashMapæ”¹ä¸ºå†…å­˜ç´§å‡‘çš„ç»“æ„ã€‚

å¯¹è°ƒè¯•å’ŒProfilerçš„æ”¹è¿›ã€‚
- ç²¾ç»†åŒ–FrameDebugger
- ç²¾ç»†åŒ–MemoryProfiler
- æ”¯æŒC#è°ƒè¯•ã€‚ç»“åˆç‰¹æ®Šhostç¨‹åºä½¿ç”¨ã€‚è¯¥hostä¸ä»…ç”¨äºå¼€å‘è°ƒè¯•ï¼Œè¿˜å°†ä½œä¸ºç”¨æˆ·äº§å“å’Œæ¸ é“å•†åˆä½œï¼Œå½¢æˆç±»ä¼¼å¾®ä¿¡å°æ¸¸æˆè¿™æ ·çš„è§£å†³æ–¹æ¡ˆã€‚

[å…¶ä»–ä¼˜åŒ–å°æ¸¸æˆå¯åŠ¨æ—¶é—´çš„ç‰¹æ€§](https://docs.unity.cn/cn/tuanjiemanual/Manual/weixin-loading-speedup.html)ã€‚

## DotnetRuntimeæ–¹æ¡ˆä»‹ç»

> [`Blazor`](https://dotnet.microsoft.com/en-us/apps/aspnet/web-apps/blazor)æ˜¯ä¸€ä¸ªä½¿ç”¨C#å¼€å‘Webçš„æ¡†æ¶ã€‚C#è„šæœ¬æ—¢å¯ä»¥é€šè¿‡AOTè¢«ç¼–è¯‘æˆwasmè¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œåœ¨ä¸€ä¸ªåŸºäºwasmå®ç°çš„.NET Runtimeä¸Šï¼ˆå®˜æ–¹ç§°ä¸º`Blazor WebAssembly hosting model`ï¼‰ï¼Œè¯¥æ–¹æ¡ˆä¸­C#ç¼–è¯‘æˆçš„ILè¢«å°è£…åœ¨[`WebCIL`](https://github.com/dotnet/runtime/blob/main/docs/design/mono/webcil.md)æ–‡ä»¶æ ¼å¼è€Œä¸æ˜¯`DLL`ä¸­ï¼Œé˜²æ­¢æ€è½¯æˆ–é˜²ç«å¢™ç¦æ­¢æµè§ˆå™¨ä¸‹è½½å’Œç¼“å­˜ä»£ç æ–‡ä»¶ã€‚è¯¥æ–¹æ¡ˆä¸­çš„.NET RuntimeåŸºäºMonoï¼ˆä¸æ˜¯Unityçš„è€æ—§Monoï¼‰æœ‰JIT, SGen, SIMDç­‰ï¼Œä½†å¹¶ä¸å¦‚CoreCLRå¼ºå¤§ã€‚

åŸºäºåŒä¸€ä¸ªåŸç†ï¼Œå¯ä»¥è®©Unity C#ä»£ç ä»¥WebCILæ–‡ä»¶å½¢å¼åœ¨æµè§ˆå™¨/å°æ¸¸æˆä¸­è¢«ä¸‹è½½ã€åŠ è½½ã€è¿è¡Œã€‚è¿™å¥—æ–¹æ¡ˆè¢«å‘½åä¸º`DotnetRuntime`ã€‚ç›¸æ¯”IL2CPP+Emscriptençš„ç°æœ‰æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ï¼š**çœå†…å­˜**ï¼Œåœ¨demoé¡¹ç›®ä¸­å¯å‡å°‘20%å¤æ‚é¡¹ç›®å¯èŠ‚çœæ›´å¤šã€‚é™„å¸¦çš„ä¼˜åŠ¿æœ‰ï¼šæ„å»ºæ—¶é—´çŸ­ã€ä»£ç çƒ­æ›´æ–°ã€.NET8çš„å…¶ä»–è¿è¡Œæ—¶ä¼˜åŒ–å’Œå·¥å…·æ”¯æŒã€‚å”¯ä¸€å¯è§çš„ä¸è¶³æ˜¯ï¼š**è¿è¡Œæ•ˆç‡ç•¥æœ‰ä¸‹é™**ï¼ŒFameTimeæœ‰çº¦5%çš„é¢å¤–æ¶ˆè€—ã€‚

æ„å»ºæµç¨‹
![](https://docs.unity.cn/cn/tuanjiemanual/uploads/doc_img/dotnet_wasm/WeixinMiniGameBuildPipeline.png)

æ„å»ºäº§ç‰©
![](https://docs.unity.cn/cn/tuanjiemanual/uploads/doc_img/dotnet_wasm/WeixinMiniGameJITBuildProducts.png)

åŠ è½½æµç¨‹
![](https://docs.unity.cn/cn/tuanjiemanual/uploads/doc_img/dotnet_wasm/WeixinMiniGameLoadProcess.png)

æ‰§è¡Œæµç¨‹ä¸¾ä¾‹
![](https://docs.unity.cn/cn/tuanjiemanual/uploads/doc_img/dotnet_wasm/WeixinMiniGameExecuteProcess.png)
